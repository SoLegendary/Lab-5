<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lab3_project: Lab-3/Sources/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lab3_project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4826224df2cefb3fb7bbdea5d7637208.html">Lab-3</a></li><li class="navelem"><a class="el" href="dir_fe1750b9a987ca39833cae2033850e56.html">Sources</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Main module. This module utilises the K70 Tower Device to input and output basic data packets in accordance to a Communication Protocol as described on UTSOnline. It is to be used in conjunction with TowerPC.exe which sends and receives these packets to and from the Tower via a Windows PC.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;Cpu.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_events_8h_source.html">Events.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="packet_8h_source.html">packet.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_u_a_r_t_8h_source.html">UART.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_flash_8h_source.html">Flash.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_l_e_ds_8h_source.html">LEDs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_r_t_c_8h_source.html">RTC.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_p_i_t_8h_source.html">PIT.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_f_t_m_8h_source.html">FTM.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gafd55a272ed701c0ea1caa8922fd4ded0"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_STARTUP</b>&#160;&#160;&#160;0x04</td></tr>
<tr class="separator:gafd55a272ed701c0ea1caa8922fd4ded0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad64394fffb2b4f7b396494845b7a3508"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_VERSION</b>&#160;&#160;&#160;0x09</td></tr>
<tr class="separator:gad64394fffb2b4f7b396494845b7a3508"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadf6ad766e0645b5b40eb5480a93ea583"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_NUMBER</b>&#160;&#160;&#160;0x0B</td></tr>
<tr class="separator:gadf6ad766e0645b5b40eb5480a93ea583"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab4efbe07fba04914334f45f97ac0af54"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_TOWERMODE</b>&#160;&#160;&#160;0x0D</td></tr>
<tr class="separator:gab4efbe07fba04914334f45f97ac0af54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga64d88c2acf5d0158f4c75cceaca1bfde"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_PROGBYTE</b>&#160;&#160;&#160;0x07</td></tr>
<tr class="separator:ga64d88c2acf5d0158f4c75cceaca1bfde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga439105059cfaa05782eaf0a771e852ce"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_READBYTE</b>&#160;&#160;&#160;0x08</td></tr>
<tr class="separator:ga439105059cfaa05782eaf0a771e852ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga47228d2cc78c94dbd415570de4f9bc7b"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CMD_SETTIME</b>&#160;&#160;&#160;0x0C</td></tr>
<tr class="separator:ga47228d2cc78c94dbd415570de4f9bc7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaa028adfe8bbcabdb7897a1898874e141"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#gaa028adfe8bbcabdb7897a1898874e141">HandleStartupPacket</a> (void)</td></tr>
<tr class="memdesc:gaa028adfe8bbcabdb7897a1898874e141"><td class="mdescLeft">&#160;</td><td class="mdescRight">The startup packet will send four packets back to the PC by default It will send the startup, version, tower number and mode packets. If flash is reset, tower number and mode will be set to studentNumber and defaultTowerMode.  <a href="group__main__module.html#gaa028adfe8bbcabdb7897a1898874e141">More...</a><br /></td></tr>
<tr class="separator:gaa028adfe8bbcabdb7897a1898874e141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga84fe5ea768aedc0d1e4e2818ff8bd406"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#ga84fe5ea768aedc0d1e4e2818ff8bd406">HandleVersionPacket</a> (void)</td></tr>
<tr class="memdesc:ga84fe5ea768aedc0d1e4e2818ff8bd406"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the tower version packet in accordance with the Tower Serial Communication Protocol document.  <a href="group__main__module.html#ga84fe5ea768aedc0d1e4e2818ff8bd406">More...</a><br /></td></tr>
<tr class="separator:ga84fe5ea768aedc0d1e4e2818ff8bd406"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac86820f24fb68dfbb9d2a3b772af94b9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#gac86820f24fb68dfbb9d2a3b772af94b9">HandleNumberPacket</a> (void)</td></tr>
<tr class="memdesc:gac86820f24fb68dfbb9d2a3b772af94b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the tower number packet in accordance with the Tower Serial Communication Protocol document.  <a href="group__main__module.html#gac86820f24fb68dfbb9d2a3b772af94b9">More...</a><br /></td></tr>
<tr class="separator:gac86820f24fb68dfbb9d2a3b772af94b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae491978a09b1e90673364b69746bcae1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#gae491978a09b1e90673364b69746bcae1">HandleTowerModePacket</a> (void)</td></tr>
<tr class="memdesc:gae491978a09b1e90673364b69746bcae1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the tower mode packet in accordance with the Tower Serial Communication Protocol document.  <a href="group__main__module.html#gae491978a09b1e90673364b69746bcae1">More...</a><br /></td></tr>
<tr class="separator:gae491978a09b1e90673364b69746bcae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga87fcb3feeebe2013c2376a2635080be5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#ga87fcb3feeebe2013c2376a2635080be5">HandleProgBytePacket</a> (void)</td></tr>
<tr class="memdesc:ga87fcb3feeebe2013c2376a2635080be5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a Flash Program Byte packet as per the Tower Serial Communication Protocol document by writing the data in parameter3 to the address given in parameter1.  <a href="group__main__module.html#ga87fcb3feeebe2013c2376a2635080be5">More...</a><br /></td></tr>
<tr class="separator:ga87fcb3feeebe2013c2376a2635080be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga229934574bc13961e301d7c8ea4742cc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#ga229934574bc13961e301d7c8ea4742cc">HandleReadBytePacket</a> (void)</td></tr>
<tr class="memdesc:ga229934574bc13961e301d7c8ea4742cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a Flash Read Byte packet as per the Tower Serial Communication Protocol document by putting in a packet with the address of the flash byte read and the data contained in that address.  <a href="group__main__module.html#ga229934574bc13961e301d7c8ea4742cc">More...</a><br /></td></tr>
<tr class="separator:ga229934574bc13961e301d7c8ea4742cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e7670b320e43d8d708a92bbe0746eff"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#ga5e7670b320e43d8d708a92bbe0746eff">HandleSetTimePacket</a> (void)</td></tr>
<tr class="memdesc:ga5e7670b320e43d8d708a92bbe0746eff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a Set Time packet as per the Tower Serial Communication Protocol document by setting sending the parameters of the packet to the RTC module to be set.  <a href="group__main__module.html#ga5e7670b320e43d8d708a92bbe0746eff">More...</a><br /></td></tr>
<tr class="separator:ga5e7670b320e43d8d708a92bbe0746eff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab7a5cb735555819b24719d6078028181"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#gab7a5cb735555819b24719d6078028181">HandlePacket</a> (void)</td></tr>
<tr class="memdesc:gab7a5cb735555819b24719d6078028181"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the packet by first checking to see what type of packet it is and processing it as per the Tower Serial Communication Protocol document.  <a href="group__main__module.html#gab7a5cb735555819b24719d6078028181">More...</a><br /></td></tr>
<tr class="separator:gab7a5cb735555819b24719d6078028181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga83e32d3437f8fdbf06974d23242a9462"><td class="memItemLeft" align="right" valign="top">
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#ga83e32d3437f8fdbf06974d23242a9462">PITCallback</a> (void *arg)</td></tr>
<tr class="memdesc:ga83e32d3437f8fdbf06974d23242a9462"><td class="mdescLeft">&#160;</td><td class="mdescRight">User callback function for use as a PIT_Init parameter Every 500ms PIT_ISR is triggered and toggles Green LED. <br /></td></tr>
<tr class="separator:ga83e32d3437f8fdbf06974d23242a9462"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2dabe81b72bf8ec8155cd875975beb07"><td class="memItemLeft" align="right" valign="top">
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#ga2dabe81b72bf8ec8155cd875975beb07">RTCCallback</a> (void *arg)</td></tr>
<tr class="memdesc:ga2dabe81b72bf8ec8155cd875975beb07"><td class="mdescLeft">&#160;</td><td class="mdescRight">User callback function for use as an RTC_Init parameter Every 1s the RTC interrupt occurs to send back clock time to the PC and toggles Yellow LED. <br /></td></tr>
<tr class="separator:ga2dabe81b72bf8ec8155cd875975beb07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad1796ae9fd33efded3fd853ba9e56d71"><td class="memItemLeft" align="right" valign="top">
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__main__module.html#gad1796ae9fd33efded3fd853ba9e56d71">FTM0Callback</a> (void *arg)</td></tr>
<tr class="memdesc:gad1796ae9fd33efded3fd853ba9e56d71"><td class="mdescLeft">&#160;</td><td class="mdescRight">User callback function for use as an FTM_Set parameter After a 1s delay set by <a class="el" href="packet_8c.html" title="Contains functions for handling packets in accordance with the Tower Communication Protocol document ...">Packet.c</a> receiving a valid packet and turning on Blue LED, this turns it off. <br /></td></tr>
<tr class="separator:gad1796ae9fd33efded3fd853ba9e56d71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (void)</td></tr>
<tr class="separator:ga840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gaabe3fea704d81e018d53b1ffec3d7f15"><td class="memItemLeft" align="right" valign="top">
volatile <a class="el" href="unionuint16union__t.html">uint16union_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>towerNumber</b> = NULL</td></tr>
<tr class="separator:gaabe3fea704d81e018d53b1ffec3d7f15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad9be0a0a6e1cb0bf51763cde9ed47a17"><td class="memItemLeft" align="right" valign="top">
volatile <a class="el" href="unionuint16union__t.html">uint16union_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>towerMode</b> = NULL</td></tr>
<tr class="separator:gad9be0a0a6e1cb0bf51763cde9ed47a17"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main module. This module utilises the K70 Tower Device to input and output basic data packets in accordance to a Communication Protocol as described on UTSOnline. It is to be used in conjunction with TowerPC.exe which sends and receives these packets to and from the Tower via a Windows PC. </p>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
